<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á”á„áŸ’á€á¾á KHQR áŸá˜áŸ’ášá¶á”áŸ‹á‘á¼á‘á¶ááŸ‹</title>
    <style>
        body {
            font-family: 'Battambang', Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1a365d;
            text-align: center;
            margin-bottom: 30px;
            font-family: 'Moul', cursive;
        }
        
        .form-section, .qr-section {
            background: #edf2f7;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0 20px 0;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Battambang', sans-serif;
        }
        
        button {
            background: #2b6cb0;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            font-weight: bold;
            transition: background 0.3s;
            font-family: 'Battambang', sans-serif;
        }
        
        button:hover {
            background: #2c5282;
        }
        
        #khqrCode {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px dashed #cbd5e0;
        }
        
        #qrImage {
            max-width: 300px;
            margin: 0 auto;
            display: block;
        }
        
        .bank-logos {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .bank-logo {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 12px;
        }
        
        .aba { background: #1a365d; }
        .acleda { background: #c53030; }
        .wing { background: #2f855a; }
        .prasac { background: #744210; }
        
        .instructions {
            background: #fffaf0;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border-left: 5px solid #dd6b20;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&family=Moul&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¾ á”á„áŸ’á€á¾á KHQR áŸá˜áŸ’ášá¶á”áŸ‹á‘á¼á‘á¶ááŸ‹</h1>
        
        <div class="bank-logos">
            <div class="bank-logo aba">ABA</div>
            <div class="bank-logo acleda">ACLEDA</div>
            <div class="bank-logo wing">Wing</div>
            <div class="bank-logo prasac">Prasac</div>
            <div class="bank-logo" style="background: #4c51bf;">+8 á’á“á¶á‚á¶áš</div>
        </div>
        
        <div class="form-section">
            <h3>ğŸ“ á–áŸááŸŒá˜á¶á“á‘á¼á‘á¶ááŸ‹</h3>
            
            <div>
                <label>áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á‘á‘á½á› (ášá”áŸáŸ‹á¢áŸ’á“á€)</label>
                <input type="text" id="merchantName" placeholder="á á¶á„ ABC" value="á á¶á„á¢áŸá”áŸŠá¸áŸáŸŠá¸">
            </div>
            
            <div>
                <label>á›áŸáá‚áá“á¸á’á“á¶á‚á¶áš</label>
                <input type="text" id="accountNumber" placeholder="123456789" value="123456789">
            </div>
            
            <div>
                <label>á’á“á¶á‚á¶áš</label>
                <select id="bankCode">
                    <option value="ABA">ABA Bank</option>
                    <option value="ACLEDA">ACLEDA Bank</option>
                    <option value="WING">Wing Bank</option>
                    <option value="PRASAC">Prasac Microfinance</option>
                    <option value="CAB">Cambodia Asia Bank</option>
                    <option value="JDB">J Trust Royal Bank</option>
                </select>
            </div>
            
            <div>
                <label>á…áŸ†á“á½á“á‘á¹á€á”áŸ’ášá¶á€áŸ‹ (ášáŸ€á›)</label>
                <input type="number" id="amount" placeholder="10000" value="10000">
                <small style="color: #718096;">á‘á»á€á‘á‘áŸá”á¾á…á„áŸ‹á±áŸ’á™á¢áá·áá·á‡á“á”á‰áŸ’á…á¼á›áŠáŸ„á™ááŸ’á›á½á“á¯á„</small>
            </div>
            
            <div>
                <label>á–áŸááŸŒá˜á¶á“á”á“áŸ’ááŸ‚á˜ (á‡á˜áŸ’ášá¾áŸ)</label>
                <textarea id="description" placeholder="á€á¶ášá‘á·á‰á‘áŸ†á“á·á‰ #001" rows="3">á€á¶ášá‘á·á‰á‘áŸ†á“á·á‰ #001</textarea>
            </div>
            
            <button onclick="generateKHQR()">ğŸ¯ á”á„áŸ’á€á¾á KHQR Code</button>
        </div>
        
        <div class="qr-section" id="qrSection" style="display: none;">
            <h3>ğŸ“± KHQR Code ášá”áŸáŸ‹á¢áŸ’á“á€</h3>
            
            <div id="khqrCode">
                <!-- QR Code á“á¹á„á”á„áŸ’á á¶á‰á“áŸ…á‘á¸á“áŸáŸ‡ -->
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="downloadQRCode()">ğŸ’¾ á‘á¶á‰á™á€ QR Code</button>
                <button onclick="printQRCode()" style="background: #2d3748; margin-top: 10px;">ğŸ–¨ï¸ á”áŸ„áŸ‡á–á»á˜áŸ’á–</button>
                <button onclick="shareQRCode()" style="background: #38a169; margin-top: 10px;">ğŸ“¤ á…áŸ‚á€ášáŸ†á›áŸ‚á€</button>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #e6fffa; border-radius: 8px;">
                <h4>ğŸ“‹ á–áŸááŸŒá˜á¶á“á‘á¼á‘á¶ááŸ‹:</h4>
                <p><strong>áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á‘á‘á½á›:</strong> <span id="displayName">-</span></p>
                <p><strong>á’á“á¶á‚á¶áš:</strong> <span id="displayBank">-</span></p>
                <p><strong>á…áŸ†á“á½á“á‘á¹á€á”áŸ’ášá¶á€áŸ‹:</strong> <span id="displayAmount">-</span> áŸ›</p>
                <p><strong>á–áŸááŸŒá˜á¶á“:</strong> <span id="displayDesc">-</span></p>
            </div>
        </div>
        
        <div class="instructions">
            <h4>ğŸ“– ášá”áŸ€á”á”áŸ’ášá¾ KHQR:</h4>
            <ol>
                <li><strong>áŸá˜áŸ’ášá¶á”áŸ‹á¢áŸ’á“á€á›á€áŸ‹:</strong> á”á„áŸ’á á¶á‰ QR Code á“áŸáŸ‡áŠá›áŸ‹á¢áá·áá·á‡á“</li>
                <li><strong>áŸá˜áŸ’ášá¶á”áŸ‹á¢áá·áá·á‡á“:</strong>
                    <ul>
                        <li>á”á¾á€á€á˜áŸ’á˜áœá·á’á¸á’á“á¶á‚á¶áš (ABA, ACLEDA, á‡á¶áŠá¾á˜)</li>
                        <li>á…á»á… "á‘á¼á‘á¶ááŸ‹ QR" á¬ "áŸáŸ’á€áŸá“ QR"</li>
                        <li>áŸáŸ’á€áŸá“ QR Code á“áŸáŸ‡</li>
                        <li>á–á·á“á·ááŸ’á™á–áŸááŸŒá˜á¶á“ á“á·á„á”á‰áŸ’á‡á¶á€áŸ‹á€á¶ášá‘á¼á‘á¶ááŸ‹</li>
                    </ul>
                </li>
                <li><strong>á”á“áŸ’á‘á¶á”áŸ‹á–á¸á‘á¼á‘á¶ááŸ‹:</strong> á¢áŸ’á“á€á‘á¶áŸ†á„á–á¸ášá“á¹á„á‘á‘á½á›á”á¶á“á€á¶ášá”á‰áŸ’á‡á¶á€áŸ‹</li>
            </ol>
        </div>
    </div>

    <script>
        // á¢á“á»á‚á˜á“áŸá”á„áŸ’á€á¾á KHQR
        function generateKHQR() {
            const merchantName = document.getElementById('merchantName').value;
            const accountNumber = document.getElementById('accountNumber').value;
            const bankCode = document.getElementById('bankCode').value;
            const amount = document.getElementById('amount').value;
            const description = document.getElementById('description').value;
            
            // á•áŸ’á‘áŸ€á„á•áŸ’á‘á¶ááŸ‹
            if (!merchantName || !accountNumber) {
                alert('áŸá¼á˜á”áŸ†á–áŸá‰áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á‘á‘á½á› á“á·á„á›áŸáá‚áá“á¸!');
                return;
            }
            
            // á”á„áŸ’á€á¾áá‘á·á“áŸ’á“á“áŸá™ KHQR
            const khqrData = {
                version: "01",
                type: "11",
                merchantAccount: {
                    bankCode: bankCode,
                    accountNumber: accountNumber
                },
                merchantName: merchantName,
                currency: "KHR",
                amount: amount || "",
                description: description || ""
            };
            
            // á”áŸ†á›áŸ‚á„á‘áŸ…á‡á¶á‘áŸ’ášá„áŸ‹á‘áŸ’ášá¶á™ KHQR string
            const khqrString = formatKHQRString(khqrData);
            
            // á”á„áŸ’á á¶á‰á–áŸááŸŒá˜á¶á“
            document.getElementById('displayName').textContent = merchantName;
            document.getElementById('displayBank').textContent = document.getElementById('bankCode').options[document.getElementById('bankCode').selectedIndex].text;
            document.getElementById('displayAmount').textContent = amount ? amount + ' áŸ›' : 'á¢áá·áá·á‡á“á“á¹á„á”á‰áŸ’á…á¼á›';
            document.getElementById('displayDesc').textContent = description || 'á˜á·á“á˜á¶á“';
            
            // á”á„áŸ’á€á¾á QR Code
            generateQRCode(khqrString);
            
            // á”á„áŸ’á á¶á‰á•áŸ’á“áŸ‚á€ QR
            document.getElementById('qrSection').style.display = 'block';
            
            // ášáŸ†á€á·á›á‘áŸ… QR Code
            document.getElementById('qrSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // á‘áŸ’ášá„áŸ‹á‘áŸ’ášá¶á™á‘á·á“áŸ’á“á“áŸá™ KHQR
        function formatKHQRString(data) {
            // á‘áŸ’ášá„áŸ‹á‘áŸ’ášá¶á™áŸáŸ’áá„áŸ‹áŠá¶ášášá”áŸáŸ‹ KHQR
            let khqrString = "000201";
            
            // á‘á·á“áŸ’á“á“áŸá™á¢áŸ’á“á€á‘á‘á½á›
            khqrString += "010212"; // Merchant Account Information
            khqrString += formatField("00", "KHQR");
            khqrString += formatField("01", data.merchantAccount.bankCode);
            khqrString += formatField("02", data.merchantAccount.accountNumber);
            
            // áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á‘á‘á½á›
            khqrString += formatField("59", data.merchantName);
            
            // ášá¼á”á·á™á”áŸááŸ’á
            khqrString += formatField("53", data.currency);
            
            // á…áŸ†á“á½á“á‘á¹á€á”áŸ’ášá¶á€áŸ‹ (á”á¾á˜á¶á“)
            if (data.amount) {
                khqrString += formatField("54", data.amount);
            }
            
            // á”áŸ’ášá‘áŸáŸ
            khqrString += formatField("58", "KH");
            
            // á–áŸááŸŒá˜á¶á“á”á“áŸ’ááŸ‚á˜ (á”á¾á˜á¶á“)
            if (data.description) {
                khqrString += formatField("80", data.description);
            }
            
            khqrString += "6304"; // CRC
            // á€áŸ’á“á»á„á€á¶ášá–á·á ááŸ’ášá¼áœá‚áá“á¶ CRC ááŸ‚áŸá˜áŸ’ášá¶á”áŸ‹á§á‘á¶á ášááŸá“áŸáŸ‡á™á¾á„á”áŸ’ášá¾áŸá¶á˜á‰áŸ’á‰
            khqrString += "ABCD";
            
            return khqrString;
        }
        
        function formatField(id, value) {
            const length = value.toString().length.toString().padStart(2, '0');
            return id + length + value;
        }
        
        // á”á„áŸ’á€á¾á QR Code
        function generateQRCode(data) {
            const qrContainer = document.getElementById('khqrCode');
            qrContainer.innerHTML = '';
            
            QRCode.toCanvas(data, { 
                width: 300,
                height: 300,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#ffffff'
                }
            }, function (error, canvas) {
                if (error) {
                    console.error(error);
                    qrContainer.innerHTML = '<p style="color: red;">á˜á·á“á¢á¶á…á”á„áŸ’á€á¾á QR Code á”á¶á“!</p>';
                    return;
                }
                
                canvas.id = 'qrImage';
                qrContainer.appendChild(canvas);
                
                // á”á“áŸ’ááŸ‚á˜á–áŸááŸŒá˜á¶á“
                const info = document.createElement('div');
                info.innerHTML = `
                    <p style="margin-top: 10px; font-size: 14px; color: #4a5568;">
                        áŸáŸ’á€áŸá“ QR Code á“áŸáŸ‡áŠáŸ„á™á”áŸ’ášá¾á€á˜áŸ’á˜áœá·á’á¸á’á“á¶á‚á¶ášášá”áŸáŸ‹á¢áŸ’á“á€
                    </p>
                    <p style="font-size: 12px; color: #718096;">
                        KHQR - á”áŸ’ášá–áŸá“áŸ’á’á‘á¼á‘á¶ááŸ‹á†áŸ’á›á„á’á“á¶á‚á¶ášášá”áŸáŸ‹á€á˜áŸ’á–á»á‡á¶
                    </p>
                `;
                qrContainer.appendChild(info);
            });
        }
        
        // á‘á¶á‰á™á€ QR Code
        function downloadQRCode() {
            const canvas = document.querySelector('#khqrCode canvas');
            if (!canvas) {
                alert('áŸá¼á˜á”á„áŸ’á€á¾á KHQR Code á‡á¶á˜á»á“áŸá·á“!');
                return;
            }
            
            const link = document.createElement('a');
            link.download = 'khqr-payment.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        
        // á”áŸ„áŸ‡á–á»á˜áŸ’á– QR Code
        function printQRCode() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>á”áŸ„áŸ‡á–á»á˜áŸ’á– KHQR</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h1 { color: #1a365d; }
                            .qr-container { text-align: center; margin: 30px 0; }
                            .info { margin-top: 20px; }
                        </style>
                    </head>
                    <body>
                        <h1>KHQR áŸá˜áŸ’ášá¶á”áŸ‹á‘á¼á‘á¶ááŸ‹</h1>
                        <div class="qr-container">
                            <img src="${document.querySelector('#khqrCode canvas').toDataURL('image/png')}" width="300">
                        </div>
                        <div class="info">
                            <p><strong>áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á‘á‘á½á›:</strong> ${document.getElementById('merchantName').value}</p>
                            <p><strong>á’á“á¶á‚á¶áš:</strong> ${document.getElementById('bankCode').options[document.getElementById('bankCode').selectedIndex].text}</p>
                            <p><strong>á…áŸ†á“á½á“:</strong> ${document.getElementById('amount').value || 'á¢áá·áá·á‡á“á“á¹á„á”á‰áŸ’á…á¼á›'} áŸ›</p>
                            <p><strong>á€á¶á›á”ášá·á…áŸ’á†áŸá‘:</strong> ${new Date().toLocaleDateString('km-KH')}</p>
                        </div>
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            }
                        <\/script>
                    </body>
                </html>
            `);
        }
        
        // á…áŸ‚á€ášáŸ†á›áŸ‚á€ QR Code
        function shareQRCode() {
            if (navigator.share) {
                navigator.share({
                    title: 'KHQR á‘á¼á‘á¶ááŸ‹',
                    text: 'áŸáŸ’á€áŸá“ KHQR Code á“áŸáŸ‡áŠá¾á˜áŸ’á”á¸á‘á¼á‘á¶ááŸ‹',
                    url: window.location.href
                });
            } else {
                // á”áŸ’ášá¾áœá·á’á¸á”á»ášá¶á
                const canvas = document.querySelector('#khqrCode canvas');
                if (canvas) {
                    canvas.toBlob(function(blob) {
                        const item = new ClipboardItem({ "image/png": blob });
                        navigator.clipboard.write([item])
                            .then(() => alert('QR Code ááŸ’ášá¼áœá”á¶á“á…á˜áŸ’á›á„á‘áŸ…á€áŸ’áá¶ášáá˜áŸ’á”áŸ€áááŸ’á‘á¶áŸáŸ‹!'))
                            .catch(err => console.error(err));
                    });
                }
            }
        }
        
        // áŠáŸ†áá¾ášá€á¶ášá–áŸá›á‘áŸ†á–áŸášá•áŸ’á‘á»á€
        window.addEventListener('load', function() {
            // á”áŸ†á–áŸá‰á‘á·á“áŸ’á“á“áŸá™á‚áŸ†ášá¼
            document.getElementById('merchantName').value = localStorage.getItem('khqrMerchantName') || 'á á¶á„á¢áŸá”áŸŠá¸áŸáŸŠá¸';
            document.getElementById('accountNumber').value = localStorage.getItem('khqrAccount') || '123456789';
            
            // ášá€áŸ’áŸá¶á‘á»á€á€á¶ášá•áŸ’á›á¶áŸáŸ‹á”áŸ’áá¼áš
            document.getElementById('merchantName').addEventListener('input', function() {
                localStorage.setItem('khqrMerchantName', this.value);
            });
            
            document.getElementById('accountNumber').addEventListener('input', function() {
                localStorage.setItem('khqrAccount', this.value);
            });
        });
    </script>
</body>
</html>